/*!
 * @name videojs-speak-descriptions-track
 * @version 1.0.0
 * @author Owen Edwards <owen.r.edwards@gmail.com>
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsSpeakDescriptionsTrack=e()}}(function(){return function(){function e(t,i,n){function s(r,o){if(!i[r]){if(!t[r]){var u="function"==typeof require&&require;if(!o&&u)return u(r,!0);if(a)return a(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var p=i[r]={exports:{}};t[r][0].call(p.exports,function(e){return s(t[r][1][e]||e)},p,p.exports,e,t,i,n)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}return e}()({1:[function(e,t,i){(function(e){var i;i="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){(function(i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return e&&"object"===(void 0===e?"undefined":r(e))&&"default"in e?e.default:e}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=s(void 0!==u?u.videojs:void 0!==i?i.videojs:null),u=s(e(1)),d={unknown:"unknown",initialized:"initialized",playing:"playing",paused:"paused",playingExtended:"playingExtended",pausedExtended:"pausedExtended"},p=function(){function e(t){n(this,e),this.player_=t,this.extendedPlayerState_=d.initialized,this.isDucked=!1,u.speechSynthesis&&u.speechSynthesis.cancel()}return a(e,[{key:"dispose",value:function(){}},{key:"play",value:function(){var e=u.speechSynthesis;e.paused&&e.resume()}},{key:"pause",value:function(){var e=u.speechSynthesis;e.speaking&&e.pause()}},{key:"paused",value:function(){return this.extendedPlayerState_===d.paused||this.extendedPlayerState_===d.pausedExtended}},{key:"textTrackChange",value:function(){for(var e=this.player_.textTracks(),t=null,i=e.length;i--;){var n=e[i];"showing"===n.mode&&"descriptions"===n.kind&&(t=n)}t&&this.speakActiveCues(t)}},{key:"speakActiveCues",value:function(e){if(u.SpeechSynthesisUtterance&&u.speechSynthesis){var t=u.speechSynthesis,i=[],n=1/0,s=-1/0,a=this.player_.currentTime();if(e.activeCues){for(var r=0;r<e.activeCues.length;r++)i.push(e.activeCues[r].text),n=Math.min(e.activeCues[r].startTime,n),s=Math.max(e.activeCues[r].endTime,s);i=i.join("\r\n").replace(/<(?:.|\n)*?>/gm,"")}if(!i)return void(t.speaking?(o.log("Pausing playback"),this.extendedPlayerState_=d.playingExtended,this.descriptionExtended=!0,this.player_.tech_.pause()):t.paused&&(o.log.warn("Speech synthesis overrun (paused) ("+this.ssu.text+") : "+this.startTime+" : "+this.endTime),t.cancel(),t.resume()));t.speaking?(o.log.warn("Speech synthesis collision ("+i+" - "+this.ssu.text+") : "+a+" : "+this.startTime+" : "+this.endTime),t.cancel()):t.paused&&(o.log.warn("Speech synthesis collision (paused) ("+i+" - "+this.ssu.text+") : "+a+" : "+this.startTime+" : "+this.endTime),t.cancel(),t.resume()),this.startTime=n,this.endTime=s,this.ssu=new u.SpeechSynthesisUtterance,this.ssu.text=i,this.ssu.lang=this.increaseLanguageLocalization(e.language),this.ssu.rate=1.1,this.ssu.pitch=1,this.ssu.volume=1,this.ssu.onstart=function(e){this.isDucked||(this.isDucked=!0,this.player_.tech_.volume(.25*this.player_.tech_.volume()))}.bind(this),this.ssu.onend=function(e){var t=(Date.now()-this.ssu.startDate)/1e3;o.log("SpeakDescriptionsTrackTTS of cue: "+this.startTime+" : "+this.endTime+" : "+(this.endTime-this.startTime)+" : "+t+" : "+(100*t/(this.endTime-this.startTime)).toFixed(1)+"%"),this.isDucked&&(this.isDucked=!1,this.player_.tech_.volume(this.player_.tech_.volume()/.25)),this.extendedPlayerState_===d.playingExtended&&(o.log("Un-pausing playback"),this.extendedPlayerState_=d.playing,this.player_.tech_.play(),this.descriptionExtended=!1)}.bind(this),this.ssu.onerror=function(e){var t=(Date.now()-this.ssu.startDate)/1e3;o.log.warn("SSU error ("+this.ssu.text+")"),o.log.warn("SpeakDescriptionsTrackTTS of cue: "+this.startTime+" : "+this.endTime+" : "+(this.endTime-this.startTime)+" : "+t+" : "+(100*t/(this.endTime-this.startTime)).toFixed(1)+"%"),this.isDucked&&(this.isDucked=!0,this.player_.tech_.volume(this.player_.tech_.volume()/.25)),this.extendedPlayerState_===d.playingExtended&&(o.log("Un-pausing playback"),this.extendedPlayerState_=d.playing,this.player_.tech_.play(),this.descriptionExtended=!1)}.bind(this),this.ssu.startDate=Date.now(),t.speak(this.ssu)}}},{key:"increaseLanguageLocalization",value:function(e){var t=this.player_.language&&this.player_.language(),i=u.navigator&&u.navigator.language;return e&&"string"==typeof e&&"string"==typeof t&&t.length>e.length&&0===t.toLowerCase().indexOf(e.toLowerCase())&&(e=t),e&&"string"==typeof e&&"string"==typeof i&&i.length>e.length&&0===i.toLowerCase().indexOf(e.toLowerCase())&&(e=i),e}}]),e}(),c=function(e){var t=void 0;return e.speakDescriptionsTTS=new p(e),e.on("texttrackchange",e.speakDescriptionsTTS.textTrackChange.bind(e.speakDescriptionsTTS)),e.on("dispose",e.speakDescriptionsTTS.dispose.bind(e.speakDescriptionsTTS)),{setSource:function(e,t){t(null,e)},setTech:function(i){t=i,e.off(t,"pause",e.handleTechPause_),t.on("pause",function(t){e.speakDescriptionsTTS&&e.speakDescriptionsTTS.extendedPlayerState_&&e.speakDescriptionsTTS.extendedPlayerState_!==d.playingExtended&&e.handleTechPause_()})},duration:function(e){return e},currentTime:function(e){return e},setCurrentTime:function(e){return e},volume:function(t){return e.speakDescriptionsTTS&&e.speakDescriptionsTTS.isDucked?t/.25:t},setVolume:function(t){return e.speakDescriptionsTTS&&e.speakDescriptionsTTS.isDucked?.25*t:t},paused:function(){if(e.speakDescriptionsTTS)return e.speakDescriptionsTTS.paused()},callPlay:function(){if(e.speakDescriptionsTTS)switch(e.speakDescriptionsTTS.extendedPlayerState_||(e.speakDescriptionsTTS.extendedPlayerState_=d.unknown),e.speakDescriptionsTTS.extendedPlayerState_){case d.unknown:case d.initialized:case d.paused:return e.speakDescriptionsTTS.extendedPlayerState_=d.playing,void e.speakDescriptionsTTS.play();case d.pausedExtended:return e.speakDescriptionsTTS.extendedPlayerState_=d.playingExtended,e.speakDescriptionsTTS.play(),o.middleware.TERMINATOR}},callPause:function(){if(e.speakDescriptionsTTS)switch(e.speakDescriptionsTTS.extendedPlayerState_||(e.speakDescriptionsTTS.extendedPlayerState_=d.unknown),e.speakDescriptionsTTS.extendedPlayerState_){case d.unknown:case d.initialized:case d.playing:return e.speakDescriptionsTTS.extendedPlayerState_=d.paused,void e.speakDescriptionsTTS.pause();case d.playingExtended:return e.speakDescriptionsTTS.extendedPlayerState_=d.pausedExtended,e.speakDescriptionsTTS.pause(),o.middleware.TERMINATOR}}}};o.use("*",c),c.VERSION="1.0.0",t.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1}]},{},[2])(2)});
//# sourceMappingURL=videojs-speak-descriptions-track.min.js.map